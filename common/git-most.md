# gitlab + mattermost

```bash
#!/bin/bash
#
# this script installs gitlab and enables mattermost
#

if [ "$(id -u)" != "0" ]; then
   echo "ERROR - This script must be run as root" 1>&2
   exit 1
fi

curl -s https://packages.gitlab.com/install/repositories/gitlab/nightly-builds/script.deb.sh | sudo bash
DEBIAN_FRONTEND=noninteractive apt-get install -y gitlab-ce

cat <<EOT > /etc/gitlab/gitlab.rb

#auto generated by $0 on $(date)
external_url 'http://gitlab.test'
logrotate['enable'] = true
mattermost_external_url 'http://mattermost.test'
mattermost['enable'] = true
mattermost['team_site_name'] = "test chat"
mattermost['team_enable_team_listing'] = true

EOT

IP=$(ifconfig eth0 2>/dev/null|grep 'inet addr'|cut -f2 -d':'|cut -f1 -d' ')

cat <<EOT >> /etc/hosts
#auto added by $0 on $(date)
$IP gitlab.test
$IP mattermost.test
#end
EOT

gitlab-ctl reconfigure

#apt-get install ruby-dev
#gitlab create_user email=john@olindata.com name='john Doe' username=john
#sudo -u mattermost /opt/gitlab/embedded/bin/mattermost -config /var/opt/gitlab/mattermost/config.json -version
#sudo -u mattermost /opt/gitlab/embedded/bin/mattermost -config /var/opt/gitlab/mattermost/config.json -create_user -team_name="ls16" -email="user3@example.com" -password="mypassword"
```
